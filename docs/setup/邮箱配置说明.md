# 邮箱配置说明

## 📍 配置位置

邮箱配置在以下位置：

### 1. 主要配置文件：`config.py` (第 28-35 行)

```python
# 邮箱服务配置
MAIL_SERVER = os.environ.get('MAIL_SERVER') or 'smtp.gmail.com'
MAIL_PORT = int(os.environ.get('MAIL_PORT') or 587)
MAIL_USE_TLS = os.environ.get('MAIL_USE_TLS', 'true').lower() in ['true', 'on', '1']
MAIL_USE_SSL = os.environ.get('MAIL_USE_SSL', 'false').lower() in ['true', 'on', '1']
MAIL_USERNAME = os.environ.get('MAIL_USERNAME') or ''
MAIL_PASSWORD = os.environ.get('MAIL_PASSWORD') or ''
MAIL_DEFAULT_SENDER = os.environ.get('MAIL_DEFAULT_SENDER') or MAIL_USERNAME
```

### 2. 推荐方式：使用 `.env` 文件（环境变量）

在项目根目录创建 `.env` 文件进行配置。

---

## 🔧 配置方法

### 方法 1: 使用 `.env` 文件（推荐）

在项目根目录创建 `.env` 文件：

```env
# 邮箱服务器配置
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USE_SSL=false

# 邮箱账号（发送邮件的邮箱）
MAIL_USERNAME=your-email@gmail.com

# 邮箱密码或应用密码
MAIL_PASSWORD=your-app-password

# 发送者邮箱（可选，默认使用 MAIL_USERNAME）
MAIL_DEFAULT_SENDER=your-email@gmail.com
```

### 方法 2: 直接修改 `config.py`

直接编辑 `config.py` 文件，修改配置值：

```python
# 邮箱服务配置
MAIL_SERVER = 'smtp.gmail.com'  # 你的邮箱服务器
MAIL_PORT = 587
MAIL_USE_TLS = True
MAIL_USERNAME = 'your-email@gmail.com'  # 你的邮箱
MAIL_PASSWORD = 'your-password'  # 你的密码
MAIL_DEFAULT_SENDER = 'your-email@gmail.com'
```

**⚠️ 注意**：不推荐直接在代码中硬编码密码，建议使用 `.env` 文件。

### 方法 3: 使用系统环境变量

在系统环境变量中设置：

**Windows PowerShell:**
```powershell
$env:MAIL_USERNAME="your-email@gmail.com"
$env:MAIL_PASSWORD="your-password"
```

**Linux/Mac:**
```bash
export MAIL_USERNAME="your-email@gmail.com"
export MAIL_PASSWORD="your-password"
```

---

## 📧 常用邮箱服务商配置

### Gmail

```env
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password  # 需要使用应用专用密码
MAIL_DEFAULT_SENDER=your-email@gmail.com
```

**重要**：Gmail 需要使用**应用专用密码**，不是普通密码。

**获取应用专用密码**：
1. 登录 Google 账号
2. 进入 [Google 账号安全设置](https://myaccount.google.com/security)
3. 启用"两步验证"
4. 生成"应用专用密码"
5. 使用生成的应用专用密码作为 `MAIL_PASSWORD`

### QQ 邮箱

```env
MAIL_SERVER=smtp.qq.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USERNAME=your-qq@qq.com
MAIL_PASSWORD=your-authorization-code  # 需要使用授权码
MAIL_DEFAULT_SENDER=your-qq@qq.com
```

**获取授权码**：
1. 登录 QQ 邮箱
2. 设置 → 账户
3. 开启 "POP3/SMTP服务"
4. 生成授权码
5. 使用授权码作为 `MAIL_PASSWORD`

### 163 邮箱

```env
MAIL_SERVER=smtp.163.com
MAIL_PORT=465
MAIL_USE_TLS=false
MAIL_USE_SSL=true
MAIL_USERNAME=your-email@163.com
MAIL_PASSWORD=your-authorization-code  # 授权码
MAIL_DEFAULT_SENDER=your-email@163.com
```

### 企业邮箱

```env
MAIL_SERVER=smtp.exmail.qq.com  # 腾讯企业邮箱示例
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USERNAME=your-email@company.com
MAIL_PASSWORD=your-password
MAIL_DEFAULT_SENDER=your-email@company.com
```

---

## 🔍 配置检查

### 查看当前配置

配置会被加载到 Flask 应用中，可以通过以下方式查看：

```python
from app import app

print("邮箱服务器:", app.config.get('MAIL_SERVER'))
print("邮箱端口:", app.config.get('MAIL_PORT'))
print("邮箱用户名:", app.config.get('MAIL_USERNAME'))
print("是否使用 TLS:", app.config.get('MAIL_USE_TLS'))
```

### 测试模式

如果没有配置邮箱（`MAIL_USERNAME` 或 `MAIL_PASSWORD` 为空），系统会自动进入**测试模式**：

- ✅ 验证码会打印到控制台
- ✅ API 响应中包含验证码（方便测试）
- ❌ 不会发送真实邮件

测试模式下，Flask 应用控制台会显示：
```
[测试模式] 发送验证码到 test@example.com: 123456
```

---

## 🚀 使用步骤

### 1. 创建 `.env` 文件

在项目根目录创建 `.env` 文件：

```env
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_DEFAULT_SENDER=your-email@gmail.com
```

### 2. 确保 `.env` 文件在 `.gitignore` 中

检查 `.gitignore` 文件，确保包含：

```
.env
.env.local
```

这样可以避免将敏感信息提交到代码仓库。

### 3. 重启 Flask 应用

配置修改后，需要重启 Flask 应用才能生效：

```bash
# 停止当前应用 (Ctrl+C)
# 然后重新启动
python app.py
```

### 4. 测试发送邮件

使用测试脚本或 API 测试：

```bash
python test_email_api.py
```

---

## 📝 配置文件优先级

配置值的加载优先级（从高到低）：

1. **系统环境变量** - 最高优先级
2. **`.env` 文件** - 推荐使用
3. **`config.py` 中的默认值** - 最低优先级

例如，如果你同时设置了系统环境变量和 `.env` 文件，系统环境变量的值会被使用。

---

## ⚠️ 安全注意事项

1. **不要将密码提交到代码仓库**
   - 使用 `.env` 文件，并确保在 `.gitignore` 中
   - 不要在 `config.py` 中硬编码密码

2. **使用应用专用密码**
   - Gmail 等邮箱服务需要使用应用专用密码，不是普通密码

3. **生产环境配置**
   - 生产环境建议使用环境变量或密钥管理服务
   - 不要使用测试邮箱配置

---

## ❓ 常见问题

### Q: 配置了邮箱但还是测试模式？

**A**: 检查：
1. `.env` 文件是否在项目根目录
2. `MAIL_USERNAME` 和 `MAIL_PASSWORD` 是否都有值
3. 是否重启了 Flask 应用
4. `.env` 文件格式是否正确（没有多余的空格）

### Q: Gmail 发送邮件失败？

**A**: Gmail 需要使用应用专用密码：
1. 启用两步验证
2. 生成应用专用密码
3. 使用应用专用密码作为 `MAIL_PASSWORD`

### Q: 如何测试邮箱配置是否正确？

**A**: 运行测试脚本：
```bash
python test_email_api.py
```

如果发送成功，会收到邮件；如果失败，会显示错误信息。

### Q: 可以配置多个邮箱吗？

**A**: 当前配置只支持一个发送邮箱。如果需要多个邮箱，需要修改代码支持多邮箱配置。

---

## 📚 相关文件

- **配置文件**: `config.py` (第 28-35 行)
- **邮箱服务**: `email_service.py`
- **环境变量加载**: `config.py` (第 5 行，使用 `python-dotenv`)
- **测试脚本**: `test_email_api.py`

---

## 🔗 快速链接

- [完整配置代码位置](config.py#L28-L35)
- [邮箱服务实现](email_service.py)
- [测试邮箱功能说明](测试邮箱功能说明.md)

