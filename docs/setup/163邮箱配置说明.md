# 163 邮箱配置详细说明

## 📧 163 邮箱 SMTP 配置

### 基本配置信息

```env
MAIL_SERVER=smtp.163.com
MAIL_PORT=465
MAIL_USE_TLS=false
MAIL_USE_SSL=true
MAIL_USERNAME=axiolxk@163.com
MAIL_PASSWORD=your-authorization-code
MAIL_DEFAULT_SENDER=axiolxk@163.com
```

---

## 🔧 配置步骤

### 步骤 1: 获取授权码

163 邮箱需要使用**授权码**而不是登录密码发送邮件。

#### 获取授权码步骤：

1. **登录 163 邮箱**
   - 访问：https://mail.163.com
   - 使用你的邮箱账号 `axiolxk@163.com` 登录

2. **进入邮箱设置**
   - 点击右上角的"设置"
   - 选择"POP3/SMTP/IMAP"

3. **开启 SMTP 服务**
   - 勾选"开启SMTP服务"
   - 如果提示需要手机验证，按提示操作

4. **获取授权码**
   - 点击"新增授权码"
   - 系统会发送验证码到绑定手机
   - 输入验证码后，系统会生成一个**授权码**（通常是一串字母和数字）
   - **重要**：这个授权码只会显示一次，请立即复制保存

5. **使用授权码**
   - 将获取的授权码作为 `MAIL_PASSWORD` 的值

### 步骤 2: 创建或修改 `.env` 文件

在项目根目录创建 `.env` 文件（如果不存在），添加以下内容：

```env
# 163 邮箱配置
MAIL_SERVER=smtp.163.com
MAIL_PORT=465
MAIL_USE_TLS=false
MAIL_USE_SSL=true
MAIL_USERNAME=axiolxk@163.com
MAIL_PASSWORD=你的授权码
MAIL_DEFAULT_SENDER=axiolxk@163.com
```

**示例**（替换为你的实际授权码）：
```env
MAIL_SERVER=smtp.163.com
MAIL_PORT=465
MAIL_USE_TLS=false
MAIL_USE_SSL=true
MAIL_USERNAME=axiolxk@163.com
MAIL_PASSWORD=ABCDEFGHIJKLMNOP
MAIL_DEFAULT_SENDER=axiolxk@163.com
```

### 步骤 3: 重启 Flask 应用

配置完成后，重启 Flask 应用：

```bash
# 停止当前应用 (Ctrl+C)
# 重新启动
python app.py
```

### 步骤 4: 测试发送

运行测试脚本验证配置：

```bash
python test_email_api.py
```

---

## ⚠️ 163 邮箱发送限制

### 每日发送数量限制

**重要限制**：

1. **免费邮箱**：
   - 每天最多发送 **500 封邮件**
   - 每小时最多发送 **100 封邮件**

2. **VIP 邮箱**（付费）：
   - 每日发送限制更高（具体以 163 官方说明为准）

### 其他限制

1. **单次发送限制**：
   - 单封邮件收件人数量有限制（通常不超过 50 个）

2. **内容限制**：
   - 不能发送垃圾邮件、广告邮件
   - 不能发送违法违规内容
   - 163 会监控发送行为，如有异常可能封禁账号

3. **IP 限制**：
   - 频繁发送可能触发 IP 限制
   - 建议控制发送频率

4. **授权码限制**：
   - 授权码需要定期更换（建议每 3-6 个月更换一次）
   - 如果授权码泄露，应立即更换

### 限制说明

- **达到限制后**：邮箱会被临时封禁，无法继续发送
- **恢复时间**：通常需要等待 24 小时后自动解除
- **建议**：
  - 控制发送频率，避免短时间内大量发送
  - 如果需要大量发送邮件，考虑使用专业邮件服务（如 SendGrid、阿里云邮件推送等）

---

## 🔄 备用端口配置

如果 465 端口被防火墙阻止，可以尝试使用 25 或 994 端口：

### 方案 1: 使用 25 端口（TLS）

```env
MAIL_SERVER=smtp.163.com
MAIL_PORT=25
MAIL_USE_TLS=true
MAIL_USE_SSL=false
MAIL_USERNAME=axiolxk@163.com
MAIL_PASSWORD=你的授权码
MAIL_DEFAULT_SENDER=axiolxk@163.com
```

### 方案 2: 使用 994 端口（SSL）

```env
MAIL_SERVER=smtp.163.com
MAIL_PORT=994
MAIL_USE_TLS=false
MAIL_USE_SSL=true
MAIL_USERNAME=axiolxk@163.com
MAIL_PASSWORD=你的授权码
MAIL_DEFAULT_SENDER=axiolxk@163.com
```

---

## ✅ 验证配置

### 检查配置是否生效

创建一个简单的测试脚本 `test_163_config.py`：

```python
from app import app

print("=" * 60)
print("163 邮箱配置检查")
print("=" * 60)
print(f"邮箱服务器: {app.config.get('MAIL_SERVER')}")
print(f"邮箱端口: {app.config.get('MAIL_PORT')}")
print(f"使用 SSL: {app.config.get('MAIL_USE_SSL')}")
print(f"使用 TLS: {app.config.get('MAIL_USE_TLS')}")
print(f"邮箱用户名: {app.config.get('MAIL_USERNAME')}")
print(f"是否配置密码: {'是' if app.config.get('MAIL_PASSWORD') else '否'}")
print(f"发送者邮箱: {app.config.get('MAIL_DEFAULT_SENDER')}")
print("=" * 60)

if app.config.get('MAIL_USERNAME') and app.config.get('MAIL_PASSWORD'):
    print("✓ 邮箱配置已设置，将发送真实邮件")
else:
    print("⚠ 邮箱配置未完整，将使用测试模式")
```

运行检查：

```bash
python test_163_config.py
```

---

## 🚨 常见问题

### Q1: 提示"认证失败"或"535 Error: authentication failed"

**原因**：
- 授权码错误
- 授权码已过期
- 未开启 SMTP 服务

**解决方法**：
1. 重新获取授权码
2. 检查 163 邮箱是否开启了 SMTP 服务
3. 确认 `.env` 文件中的授权码没有多余空格

### Q2: 提示"连接超时"或"无法连接到服务器"

**原因**：
- 端口被防火墙阻止
- 网络连接问题

**解决方法**：
1. 尝试使用备用端口（25 或 994）
2. 检查防火墙设置
3. 确认网络连接正常

### Q3: 发送失败，提示"发送频率过高"

**原因**：
- 已达到发送限制

**解决方法**：
1. 等待一段时间后再发送
2. 控制发送频率
3. 考虑升级为 VIP 邮箱

### Q4: 如何查看已发送邮件的数量？

**查看方法**：
1. 登录 163 邮箱网页版
2. 在"已发送"文件夹可以看到发送记录
3. 163 后台可能会显示发送统计

---

## 📋 完整配置示例

### `.env` 文件完整内容

```env
# Flask 配置
SECRET_KEY=your-secret-key

# 数据库配置
DATABASE_URL=sqlite:///app.db

# 163 邮箱配置
MAIL_SERVER=smtp.163.com
MAIL_PORT=465
MAIL_USE_TLS=false
MAIL_USE_SSL=true
MAIL_USERNAME=axiolxk@163.com
MAIL_PASSWORD=你的授权码
MAIL_DEFAULT_SENDER=axiolxk@163.com

# CORS 配置
CORS_ORIGINS=http://localhost:5173,http://localhost:3000
```

---

## 💡 最佳实践建议

1. **保存授权码**：
   - 将授权码保存在安全的地方
   - 不要将 `.env` 文件提交到代码仓库

2. **监控发送量**：
   - 记录每日发送的邮件数量
   - 避免达到限制

3. **错误处理**：
   - 实现重试机制
   - 处理发送失败的情况

4. **生产环境**：
   - 考虑使用专业的邮件服务（如阿里云邮件推送、腾讯云邮件服务等）
   - 这些服务通常有更高的发送限制和更好的稳定性

---

## 📞 获取帮助

如果遇到问题：
1. 检查 163 邮箱的帮助文档
2. 查看 Flask 应用的控制台错误信息
3. 运行测试脚本查看详细错误

---

## 📝 总结

**配置要点**：
- ✅ 使用授权码，不是登录密码
- ✅ 端口 465，使用 SSL
- ✅ 每日最多 500 封邮件
- ✅ 每小时最多 100 封邮件
- ✅ 控制发送频率，避免触发限制

配置完成后，重启 Flask 应用即可开始发送邮件！

