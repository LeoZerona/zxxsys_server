# åˆ›å»ºä»»åŠ¡æ¥å£æµ‹è¯•è¯´æ˜

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨APIæµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

**å‰ææ¡ä»¶**ï¼š
1. ç¡®ä¿Flaskåº”ç”¨æ­£åœ¨è¿è¡Œï¼š
   ```bash
   python app.py
   ```

2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
   ```bash
   python scripts/test/test_create_dedup_task_api.py
   ```

**æµ‹è¯•å†…å®¹**ï¼š
- âœ… ä½¿ç”¨é»˜è®¤å‚æ•°åˆ›å»ºä»»åŠ¡
- âœ… æŒ‡å®šåˆ†æç±»å‹åˆ›å»ºä»»åŠ¡
- âœ… æ— æ•ˆçš„åˆ†æç±»å‹ï¼ˆé”™è¯¯å¤„ç†ï¼‰
- âœ… è·å–ä»»åŠ¡è¯¦æƒ…

### æ–¹æ³•äºŒï¼šä½¿ç”¨å•å…ƒæµ‹è¯•è„šæœ¬

**è¿è¡Œå•å…ƒæµ‹è¯•**ï¼š
```bash
python scripts/test/test_create_dedup_task.py
```

**æµ‹è¯•å†…å®¹**ï¼š
- âœ… æ¨¡å‹å­—æ®µéªŒè¯
- âœ… é¢„ä¼°æ—¶é•¿è®¡ç®—
- âœ… æ•°æ®åº“æ“ä½œ

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨curlæ‰‹åŠ¨æµ‹è¯•

#### 1. åˆ›å»ºä»»åŠ¡ï¼ˆé»˜è®¤å‚æ•°ï¼‰

```bash
curl -X POST http://localhost:5000/api/dedup/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "task_name": "æˆ‘çš„å»é‡ä»»åŠ¡"
  }'
```

#### 2. åˆ›å»ºä»»åŠ¡ï¼ˆæŒ‡å®šåˆ†æç±»å‹ï¼‰

```bash
curl -X POST http://localhost:5000/api/dedup/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "task_name": "æˆ‘çš„å»é‡ä»»åŠ¡",
    "analysis_type": "full",
    "config": {
      "similarity_threshold": 0.85
    }
  }'
```

#### 3. è·å–ä»»åŠ¡è¯¦æƒ…

```bash
curl http://localhost:5000/api/dedup/tasks/1
```

#### 4. æµ‹è¯•æ— æ•ˆçš„åˆ†æç±»å‹ï¼ˆåº”è¯¥è¿”å›é”™è¯¯ï¼‰

```bash
curl -X POST http://localhost:5000/api/dedup/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "task_name": "æµ‹è¯•ä»»åŠ¡",
    "analysis_type": "invalid_type"
  }'
```

### æ–¹æ³•å››ï¼šä½¿ç”¨Postmanæµ‹è¯•

#### åˆ›å»ºä»»åŠ¡è¯·æ±‚

**Method**: `POST`  
**URL**: `http://localhost:5000/api/dedup/tasks`  
**Headers**:
```
Content-Type: application/json
```

**Body** (raw JSON):
```json
{
  "task_name": "æˆ‘çš„å»é‡ä»»åŠ¡",
  "analysis_type": "full",
  "config": {
    "similarity_threshold": 0.85
  }
}
```

**é¢„æœŸå“åº”** (201):
```json
{
  "success": true,
  "message": "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "task_name": "æˆ‘çš„å»é‡ä»»åŠ¡",
    "status": "pending",
    "total_groups": 150,
    "processed_groups": 0,
    "total_questions": 2500,
    "exact_duplicate_groups": 0,
    "exact_duplicate_pairs": 0,
    "similar_duplicate_pairs": 0,
    "progress_percentage": 0.0,
    "analysis_type": "full",
    "estimated_duration": 550,
    "config": {
      "similarity_threshold": 0.85
    },
    "created_at": "2024-01-01T12:00:00",
    "updated_at": "2024-01-01T12:00:00"
  }
}
```

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### 1. å¯åŠ¨Flaskåº”ç”¨

```bash
python app.py
```

ç¡®ä¿åº”ç”¨åœ¨ `http://localhost:5000` è¿è¡Œã€‚

### 2. ç¡®è®¤æ•°æ®åº“è¿ç§»å·²å®Œæˆ

```bash
python scripts/database/migrate_add_dedup_task_fields.py
```

### 3. ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸

```bash
python scripts/utils/check_database_config.py
```

## âœ… éªŒè¯è¦ç‚¹

### 1. å“åº”å­—æ®µéªŒè¯

åˆ›å»ºä»»åŠ¡åï¼ŒéªŒè¯å“åº”ä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- âœ… `id`: ä»»åŠ¡ID
- âœ… `status`: ä»»åŠ¡çŠ¶æ€ï¼ˆåº”ä¸º `pending`ï¼‰
- âœ… `analysis_type`: åˆ†æç±»å‹ï¼ˆåº”ä¸º `full`ã€`incremental` æˆ– `custom`ï¼‰
- âœ… `total_groups`: æ€»åˆ†ç»„æ•°ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
- âœ… `total_questions`: æ€»é¢˜ç›®æ•°ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
- âœ… `estimated_duration`: é¢„ä¼°æ—¶é•¿ï¼ˆç§’ï¼Œè‡ªåŠ¨è®¡ç®—ï¼‰

### 2. é¢„ä¼°æ—¶é•¿è®¡ç®—éªŒè¯

éªŒè¯é¢„ä¼°æ—¶é•¿æ˜¯å¦ç¬¦åˆè®¡ç®—å…¬å¼ï¼š
```
é¢„ä¼°æ—¶é•¿ï¼ˆç§’ï¼‰= 30 + (æ€»é¢˜ç›®æ•° Ã— 0.1) + (æ€»åˆ†ç»„æ•° Ã— 5)
```

### 3. é”™è¯¯å¤„ç†éªŒè¯

æµ‹è¯•ä»¥ä¸‹é”™è¯¯åœºæ™¯ï¼š
- âœ… æ— æ•ˆçš„åˆ†æç±»å‹ï¼ˆåº”è¿”å›400é”™è¯¯ï¼‰
- âœ… æ— æ•ˆçš„JSONæ ¼å¼ï¼ˆåº”è¿”å›400é”™è¯¯ï¼‰
- âœ… æœåŠ¡å™¨é”™è¯¯ï¼ˆåº”è¿”å›500é”™è¯¯ï¼‰

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æ•°æ®åº“ä¸­çš„ä»»åŠ¡è®°å½•

```python
from src.app import app, db
from src.models.question_dedup import DedupTask

with app.app_context():
    tasks = DedupTask.query.all()
    for task in tasks:
        print(f"ID: {task.id}, åç§°: {task.task_name}, çŠ¶æ€: {task.status}")
        print(f"  åˆ†æç±»å‹: {task.analysis_type}, é¢„ä¼°æ—¶é•¿: {task.estimated_duration}ç§’")
```

### æŸ¥çœ‹Flaskæ—¥å¿—

Flaskåº”ç”¨ä¼šè¾“å‡ºè¯¦ç»†çš„è¯·æ±‚æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- è¯·æ±‚URLå’Œæ–¹æ³•
- è¯·æ±‚å‚æ•°
- å“åº”çŠ¶æ€ç 
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

## ğŸ“ æµ‹è¯•ç”¨ä¾‹

### ç”¨ä¾‹1: åˆ›å»ºå…¨é‡åˆ†æä»»åŠ¡

**è¯·æ±‚**:
```json
{
  "task_name": "å…¨é‡åˆ†æä»»åŠ¡",
  "analysis_type": "full"
}
```

**é¢„æœŸç»“æœ**:
- çŠ¶æ€ç : 201
- `status`: "pending"
- `analysis_type`: "full"
- `total_groups` > 0
- `total_questions` > 0
- `estimated_duration` > 0

### ç”¨ä¾‹2: åˆ›å»ºå¢é‡åˆ†æä»»åŠ¡

**è¯·æ±‚**:
```json
{
  "task_name": "å¢é‡åˆ†æä»»åŠ¡",
  "analysis_type": "incremental",
  "config": {
    "similarity_threshold": 0.9
  }
}
```

**é¢„æœŸç»“æœ**:
- çŠ¶æ€ç : 201
- `status`: "pending"
- `analysis_type`: "incremental"
- `config.similarity_threshold`: 0.9

### ç”¨ä¾‹3: æ— æ•ˆçš„åˆ†æç±»å‹

**è¯·æ±‚**:
```json
{
  "task_name": "æµ‹è¯•ä»»åŠ¡",
  "analysis_type": "invalid"
}
```

**é¢„æœŸç»“æœ**:
- çŠ¶æ€ç : 400
- `success`: false
- `error_code`: "INVALID_PARAMETER"
- åŒ…å«é”™è¯¯æ¶ˆæ¯

## ğŸš€ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

```bash
# 1. å¯åŠ¨åº”ç”¨ï¼ˆç»ˆç«¯1ï¼‰
python app.py

# 2. è¿è¡ŒAPIæµ‹è¯•ï¼ˆç»ˆç«¯2ï¼‰
python scripts/test/test_create_dedup_task_api.py

# 3. è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆç»ˆç«¯2ï¼‰
python scripts/test/test_create_dedup_task.py
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åˆ›å»ºä»»åŠ¡æ¥å£å®Œæˆè¯´æ˜](../api/åˆ›å»ºä»»åŠ¡æ¥å£å®Œæˆè¯´æ˜.md)
- [é¢˜ç›®å»é‡æ¥å£å‰ç«¯å¯¹æ¥](../api/é¢˜ç›®å»é‡æ¥å£å‰ç«¯å¯¹æ¥.md)
- [æ•°æ®åº“è¿ç§»è¯´æ˜](../database/é¢˜ç›®å»é‡ä»»åŠ¡å­—æ®µæ›´æ–°è¯´æ˜.md)

