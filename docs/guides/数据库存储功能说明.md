# é¢˜ç›®å»é‡æ•°æ®åº“å­˜å‚¨åŠŸèƒ½è¯´æ˜

## âœ… åŠŸèƒ½å·²å®ç°

é¢˜ç›®å»é‡æœåŠ¡å·²æ›´æ–°ï¼Œæ”¯æŒå°†æ•°æ®å†™å…¥æ•°æ®åº“ï¼ŒåŒæ—¶ä¿ç•™JSONæ–‡ä»¶ç”¨äºè¿›åº¦ç®¡ç†å’Œæ–­ç‚¹ç»­ä¼ ã€‚

## ğŸ“‹ å®ç°çš„åŠŸèƒ½

### 1. ä»»åŠ¡ç®¡ç†

- **åˆ›å»ºä»»åŠ¡è®°å½•**ï¼š`init_dedup_session()` æ—¶è‡ªåŠ¨åˆ›å»º `DedupTask` è®°å½•
- **ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª**ï¼špending â†’ running â†’ completed/error
- **ä»»åŠ¡ç»Ÿè®¡æ›´æ–°**ï¼šå®æ—¶æ›´æ–°å¤„ç†è¿›åº¦å’Œç»Ÿè®¡ä¿¡æ¯

### 2. æ•°æ®å­˜å‚¨

- **å®Œå…¨é‡å¤ç»„**ï¼šä¿å­˜åˆ° `question_duplicate_groups` å’Œ `question_duplicate_group_items`
- **ç›¸ä¼¼é‡å¤å¯¹**ï¼šä¿å­˜åˆ° `question_duplicate_pairs`ï¼ˆå¾…æ­¥éª¤3-6å®ç°åï¼‰
- **ç‰¹å¾æ•°æ®**ï¼šå¯ä¿å­˜åˆ° `question_dedup_features`ï¼ˆå¾…æ­¥éª¤3-4å®ç°åï¼‰

### 3. è¿›åº¦ç®¡ç†

- **åŒé‡å­˜å‚¨**ï¼šJSONæ–‡ä»¶ï¼ˆè¿›åº¦ï¼‰+ æ•°æ®åº“ï¼ˆç»“æœï¼‰
- **æ–­ç‚¹ç»­ä¼ **ï¼šé€šè¿‡JSONæ–‡ä»¶è®°å½•å¤„ç†è¿›åº¦
- **çŠ¶æ€åŒæ­¥**ï¼šJSONå’Œæ•°æ®åº“çŠ¶æ€ä¿æŒåŒæ­¥

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åˆå§‹åŒ–ä¼šè¯

```python
from src.app import app, db
from src.services.question_dedup_service import QuestionDedupService

with app.app_context():
    # åˆå§‹åŒ–ï¼ˆä¼šåˆ›å»ºæ•°æ®åº“ä»»åŠ¡è®°å½•ï¼‰
    progress = QuestionDedupService.init_dedup_session(
        task_name="2026å¹´1æœˆå»é‡ä»»åŠ¡",
        config={"similarity_threshold": 0.8}
    )
    task_id = progress['task_id']
    print(f"ä»»åŠ¡ID: {task_id}")
```

### å¤„ç†åˆ†ç»„

```python
# å¤„ç†ä¸€ä¸ªåˆ†ç»„ï¼ˆä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“ï¼‰
results = QuestionDedupService.process_next_group()
if results:
    print(f"å®Œå…¨é‡å¤: {len(results['exact_duplicates'])} ç»„")
```

### æŸ¥è¯¢ä»»åŠ¡

```python
from src.models.question_dedup import DedupTask

task = DedupTask.query.get(task_id)
print(f"çŠ¶æ€: {task.status}")
print(f"è¿›åº¦: {task.processed_groups}/{task.total_groups}")
print(f"å®Œå…¨é‡å¤ç»„: {task.exact_duplicate_groups}")
print(f"å®Œå…¨é‡å¤å¯¹: {task.exact_duplicate_pairs}")
```

## ğŸ“Š æ•°æ®æµç¨‹

1. **åˆå§‹åŒ–** â†’ åˆ›å»º `DedupTask` è®°å½•
2. **å¤„ç†åˆ†ç»„** â†’ 
   - æ¸…æ´—é¢˜å¹²
   - æ£€æµ‹å®Œå…¨é‡å¤
   - ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆç»„è®°å½• + æ˜ç»†è®°å½•ï¼‰
   - æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
3. **å®Œæˆ** â†’ æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º `completed`

## ğŸ—„ï¸ æ•°æ®åº“è¡¨å…³ç³»

```
dedup_tasks (ä»»åŠ¡)
  â”œâ”€ question_duplicate_groups (å®Œå…¨é‡å¤ç»„)
  â”‚    â””â”€ question_duplicate_group_items (ç»„æ˜ç»†)
  â””â”€ question_duplicate_pairs (é‡å¤å¯¹)
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **äº‹åŠ¡å¤„ç†**ï¼šæ•°æ®åº“æ“ä½œåœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå‡ºé”™æ—¶ä¼šå›æ»š
2. **é”™è¯¯å¤„ç†**ï¼šé”™è¯¯ä¼šè®°å½•åˆ°JSONæ–‡ä»¶å’Œæ•°æ®åº“
3. **è¿›åº¦æ–‡ä»¶**ï¼šJSONæ–‡ä»¶ç”¨äºæ–­ç‚¹ç»­ä¼ ï¼Œä¸è¦æ‰‹åŠ¨åˆ é™¤
4. **ä»»åŠ¡ID**ï¼šè¿›åº¦æ–‡ä»¶ä¸­åŒ…å« `task_id`ï¼Œç”¨äºå…³è”æ•°æ®åº“è®°å½•

## ğŸ”„ åç»­å·¥ä½œ

- [ ] å®ç°æ­¥éª¤3-6åï¼Œä¿å­˜ç›¸ä¼¼é‡å¤å¯¹å’Œç‰¹å¾æ•°æ®
- [ ] æ·»åŠ ç‰¹å¾æ•°æ®ä¿å­˜åŠŸèƒ½ï¼ˆN-gramã€MinHashï¼‰
- [ ] åˆ›å»ºAPIæ¥å£ä¾›å‰ç«¯æŸ¥è¯¢

---

**æœ€åæ›´æ–°**ï¼š2026-01-03

