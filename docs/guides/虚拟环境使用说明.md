# Python 虚拟环境使用说明

## 📋 目录
- [激活虚拟环境](#激活虚拟环境)
- [安装依赖](#安装依赖)
- [常见问题](#常见问题)
- [快速启动](#快速启动)

---

## 🔧 激活虚拟环境

### 方法一：手动激活（推荐）

在 PowerShell 中执行：

```powershell
# 进入项目目录（如果还没进入）
cd D:\data\zxx\zxxsys_server

# 激活虚拟环境
.\venv\Scripts\Activate.ps1
```

激活成功后，命令提示符前会显示 `(venv)`，例如：
```
(venv) PS D:\data\zxx\zxxsys_server>
```

### 方法二：使用启动脚本

直接运行项目提供的 PowerShell 启动脚本：

```powershell
.\start.ps1
```

这会自动激活虚拟环境并启动 Flask 应用。

### 方法三：使用批处理文件（Windows CMD）

如果 PowerShell 有权限问题，可以使用批处理文件：

```cmd
start.bat
```

---

## 📦 安装依赖

激活虚拟环境后，安装项目依赖：

```powershell
# 确保虚拟环境已激活（命令提示符前有 (venv)）
pip install -r requirements.txt
```

或者升级 pip 后安装：

```powershell
python -m pip install --upgrade pip
pip install -r requirements.txt
```

---

## ⚠️ 常见问题

### 问题 1: 执行策略限制

**错误信息**：
```
无法加载文件 D:\...\Activate.ps1，因为在此系统上禁止运行脚本
```

**解决方法**：

在 PowerShell 中（以管理员身份运行），执行：

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

然后重新激活虚拟环境。

**或者**使用批处理文件替代：
```cmd
.\venv\Scripts\activate.bat
```

### 问题 2: 找不到 flask 模块

**错误信息**：
```
ModuleNotFoundError: No module named 'flask'
```

**解决方法**：

1. **确认虚拟环境已激活**
   - 检查命令提示符前是否有 `(venv)`
   - 如果没有，先激活虚拟环境

2. **安装依赖**
   ```powershell
   pip install -r requirements.txt
   ```

3. **验证安装**
   ```powershell
   pip list | Select-String flask
   ```
   应该能看到 flask 及其版本信息。

### 问题 3: 虚拟环境未正确创建

如果 `venv` 目录不存在或损坏，需要重新创建：

```powershell
# 删除旧的虚拟环境（如果有）
Remove-Item -Recurse -Force venv

# 创建新的虚拟环境
python -m venv venv

# 激活虚拟环境
.\venv\Scripts\Activate.ps1

# 安装依赖
pip install -r requirements.txt
```

---

## 🚀 快速启动

### 完整启动流程

```powershell
# 1. 进入项目目录
cd D:\data\zxx\zxxsys_server

# 2. 激活虚拟环境
.\venv\Scripts\Activate.ps1

# 3. （首次使用时）安装依赖
pip install -r requirements.txt

# 4. 启动应用
python app.py
```

### 使用启动脚本（最简单）

```powershell
# 直接运行启动脚本
.\start.ps1
```

---

## ✅ 验证虚拟环境

激活虚拟环境后，验证是否正确：

```powershell
# 检查 Python 路径（应该指向 venv）
python --version
where python

# 检查已安装的包
pip list

# 检查 Flask 是否已安装
python -c "import flask; print(flask.__version__)"
```

---

## 📝 退出虚拟环境

使用完毕后，可以退出虚拟环境：

```powershell
deactivate
```

---

## 💡 提示

- **每次打开新的 PowerShell 窗口都需要重新激活虚拟环境**
- **虚拟环境只对当前终端会话有效**
- **项目已经提供了 `start.ps1` 脚本，可以直接使用**

---

## 🔗 相关文档

- [项目启动说明](../README.md)
- [环境配置说明](../setup/数据库配置说明.md)

