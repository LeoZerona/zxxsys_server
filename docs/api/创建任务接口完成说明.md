# åˆ›å»ºä»»åŠ¡æ¥å£å®Œæˆè¯´æ˜

## âœ… å®Œæˆå†…å®¹

### 1. æ•°æ®åº“æ¨¡å‹æ›´æ–°
- âœ… åœ¨ `DedupTask` æ¨¡å‹ä¸­æ·»åŠ äº† `analysis_type` å­—æ®µï¼ˆåˆ†æç±»å‹ï¼‰
- âœ… åœ¨ `DedupTask` æ¨¡å‹ä¸­æ·»åŠ äº† `estimated_duration` å­—æ®µï¼ˆé¢„ä¼°æ—¶é•¿ï¼‰
- âœ… æ›´æ–°äº† `to_dict()` æ–¹æ³•ï¼ŒåŒ…å«æ–°å­—æ®µ

### 2. åˆ›å»ºä»»åŠ¡æ¥å£å¢å¼º
- âœ… ä¿®æ”¹äº† `POST /api/dedup/tasks` æ¥å£
- âœ… è‡ªåŠ¨è®¡ç®—æ€»åˆ†ç»„æ•°ï¼ˆ`total_groups`ï¼‰
- âœ… è‡ªåŠ¨è®¡ç®—æ€»é¢˜ç›®æ•°ï¼ˆ`total_questions`ï¼‰
- âœ… æ ¹æ®é¢˜ç›®æ•°é‡å’Œåˆ†ç»„æ•°è‡ªåŠ¨è®¡ç®—é¢„ä¼°æ—¶é•¿ï¼ˆ`estimated_duration`ï¼‰
- âœ… æ”¯æŒä¼ å…¥ `analysis_type` å‚æ•°
- âœ… ä»»åŠ¡åˆ›å»ºåçŠ¶æ€ä¸º `pending`ï¼ˆå¾…å¯åŠ¨ï¼‰ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œ

### 3. æ•°æ®åº“è¿ç§»
- âœ… åˆ›å»ºäº†æ•°æ®åº“è¿ç§»SQLè„šæœ¬ï¼š`sql/add_dedup_task_fields.sql`
- âœ… åˆ›å»ºäº†Pythonè¿ç§»è„šæœ¬ï¼š`scripts/database/migrate_add_dedup_task_fields.py`
- âœ… è¿ç§»è„šæœ¬å·²æˆåŠŸæ‰§è¡Œï¼Œå­—æ®µå·²æ·»åŠ åˆ°æ•°æ®åº“

### 4. æ–‡æ¡£æ›´æ–°
- âœ… æ›´æ–°äº†æ¥å£æ–‡æ¡£ï¼š`docs/api/é¢˜ç›®å»é‡æ¥å£å‰ç«¯å¯¹æ¥.md`
- âœ… åˆ›å»ºäº†æ•°æ®åº“è¿ç§»è¯´æ˜ï¼š`docs/database/é¢˜ç›®å»é‡ä»»åŠ¡å­—æ®µæ›´æ–°è¯´æ˜.md`
- âœ… åˆ›å»ºäº†å®Œæˆè¯´æ˜æ–‡æ¡£ï¼š`docs/api/åˆ›å»ºä»»åŠ¡æ¥å£å®Œæˆè¯´æ˜.md`

### 5. æµ‹è¯•éªŒè¯
- âœ… åˆ›å»ºäº†æµ‹è¯•è„šæœ¬ï¼š`scripts/test/test_create_dedup_task.py`
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

## ğŸ“‹ æ¥å£ä½¿ç”¨è¯´æ˜

### åˆ›å»ºä»»åŠ¡æ¥å£

**æ¥å£åœ°å€**: `POST /api/dedup/tasks`

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "task_name": "æˆ‘çš„å»é‡ä»»åŠ¡",
  "analysis_type": "full",
  "config": {
    "similarity_threshold": 0.85
  }
}
```

**è¯·æ±‚å‚æ•°**:
- `task_name` (å¯é€‰): ä»»åŠ¡åç§°ï¼Œä¸æä¾›åˆ™è‡ªåŠ¨ç”Ÿæˆ
- `analysis_type` (å¯é€‰): åˆ†æç±»å‹ï¼Œé»˜è®¤ `"full"`
  - `"full"`: å…¨é‡åˆ†æï¼ˆåˆ†ææ‰€æœ‰é¢˜ç›®ï¼‰
  - `"incremental"`: å¢é‡åˆ†æï¼ˆåªåˆ†ææ–°å¢é¢˜ç›®ï¼‰
  - `"custom"`: è‡ªå®šä¹‰åˆ†æï¼ˆæŒ‰æ¡ä»¶ç­›é€‰ï¼‰
- `config` (å¯é€‰): ä»»åŠ¡é…ç½®
  - `similarity_threshold`: ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œé»˜è®¤ 0.8

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "task_name": "æˆ‘çš„å»é‡ä»»åŠ¡",
    "status": "pending",
    "total_groups": 150,
    "processed_groups": 0,
    "total_questions": 2500,
    "exact_duplicate_groups": 0,
    "exact_duplicate_pairs": 0,
    "similar_duplicate_pairs": 0,
    "progress_percentage": 0.0,
    "analysis_type": "full",
    "estimated_duration": 550,
    "config": {
      "similarity_threshold": 0.85
    },
    "created_at": "2024-01-01T12:00:00",
    "updated_at": "2024-01-01T12:00:00"
  }
}
```

## ğŸ”¢ é¢„ä¼°æ—¶é•¿è®¡ç®—è§„åˆ™

ç³»ç»Ÿä¼šæ ¹æ®ä»¥ä¸‹è§„åˆ™è‡ªåŠ¨è®¡ç®—é¢„ä¼°æ—¶é•¿ï¼š

```
é¢„ä¼°æ—¶é•¿ï¼ˆç§’ï¼‰= 30 + (æ€»é¢˜ç›®æ•° Ã— 0.1) + (æ€»åˆ†ç»„æ•° Ã— 5)
```

**è®¡ç®—è¯´æ˜**:
- **åŸºç¡€å¼€é”€**: 30ç§’ï¼ˆä»»åŠ¡åˆå§‹åŒ–ã€æ•°æ®åº“è¿æ¥ç­‰ï¼‰
- **é¢˜ç›®å¤„ç†æ—¶é—´**: æ¯ä¸ªé¢˜ç›® 0.1ç§’ï¼ˆåŒ…æ‹¬æ¸…æ´—ã€ç‰¹å¾æå–ã€ç›¸ä¼¼åº¦è®¡ç®—ç­‰ï¼‰
- **åˆ†ç»„å¤„ç†æ—¶é—´**: æ¯ä¸ªåˆ†ç»„ 5ç§’ï¼ˆåˆ†ç»„åˆå§‹åŒ–ã€æ•°æ®åŠ è½½ç­‰ï¼‰

**ç¤ºä¾‹**:
- æ€»é¢˜ç›®æ•°: 2500
- æ€»åˆ†ç»„æ•°: 150
- é¢„ä¼°æ—¶é•¿: 30 + (2500 Ã— 0.1) + (150 Ã— 5) = 30 + 250 + 750 = 1030ç§’ï¼ˆçº¦17åˆ†é’Ÿï¼‰

## ğŸ“Š è¿”å›å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `id` | Integer | ä»»åŠ¡ID |
| `task_name` | String | ä»»åŠ¡åç§° |
| `status` | String | ä»»åŠ¡çŠ¶æ€ï¼Œåˆ›å»ºæ—¶ä¸º `pending`ï¼ˆå¾…å¯åŠ¨ï¼‰ |
| `total_groups` | Integer | æ€»åˆ†ç»„æ•°ï¼ˆç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼‰ |
| `processed_groups` | Integer | å·²å¤„ç†åˆ†ç»„æ•°ï¼ˆåˆå§‹ä¸º 0ï¼‰ |
| `total_questions` | Integer | æ€»é¢˜ç›®æ•°ï¼ˆç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼‰ |
| `analysis_type` | String | åˆ†æç±»å‹ï¼ˆfull/incremental/customï¼‰ |
| `estimated_duration` | Integer | é¢„ä¼°æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨è®¡ç®— |
| `config` | Object | ä»»åŠ¡é…ç½®ä¿¡æ¯ |
| `created_at` | String | åˆ›å»ºæ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |
| `updated_at` | String | æ›´æ–°æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |

## ğŸ¯ å‰ç«¯å¯¹æ¥è¦ç‚¹

### 1. å­˜å‚¨è¿”å›æ•°æ®
å‰ç«¯éœ€è¦å°†æ¥å£è¿”å›çš„ä»¥ä¸‹å­—æ®µå­˜å‚¨åˆ°æ•°æ®åº“ï¼š
- `analysis_type`: åˆ†æç±»å‹
- `total_questions`: é¢˜ç›®æ•°é‡
- `estimated_duration`: é¢„ä¼°æ—¶é•¿

### 2. æ˜¾ç¤ºé¢„ä¼°æ—¶é•¿
å¯ä»¥åœ¨ä»»åŠ¡åˆ—è¡¨ä¸­æ˜¾ç¤ºé¢„ä¼°æ—¶é•¿ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£ä»»åŠ¡çš„å¤„ç†æ—¶é—´ï¼š
```typescript
const formatDuration = (seconds: number) => {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;
  return `${minutes}åˆ†${remainingSeconds}ç§’`;
};
```

### 3. åˆ†æç±»å‹é€‰æ‹©
åˆ›å»ºä»»åŠ¡æ—¶å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©åˆ†æç±»å‹ï¼š
- `full`: å…¨é‡åˆ†æï¼ˆåˆ†ææ‰€æœ‰é¢˜ç›®ï¼‰- é»˜è®¤é€‰é¡¹
- `incremental`: å¢é‡åˆ†æï¼ˆåªåˆ†ææ–°å¢é¢˜ç›®ï¼‰
- `custom`: è‡ªå®šä¹‰åˆ†æï¼ˆæŒ‰æ¡ä»¶ç­›é€‰ï¼‰

### 4. ä»»åŠ¡çŠ¶æ€ç®¡ç†
- ä»»åŠ¡åˆ›å»ºåçŠ¶æ€ä¸º `pending`ï¼ˆå¾…å¯åŠ¨ï¼‰
- éœ€è¦è°ƒç”¨ `POST /api/dedup/tasks/{task_id}/start` æ¥å£æ¥å¯åŠ¨ä»»åŠ¡
- ä»»åŠ¡å¯åŠ¨åçŠ¶æ€å˜ä¸º `running`ï¼ˆè¿è¡Œä¸­ï¼‰

## ğŸš€ æ‰§è¡Œæ­¥éª¤

### 1. æ•°æ®åº“è¿ç§»ï¼ˆå·²å®Œæˆï¼‰
```bash
# æ–¹å¼1: ä½¿ç”¨Pythonè„šæœ¬ï¼ˆæ¨èï¼‰
python scripts/database/migrate_add_dedup_task_fields.py

# æ–¹å¼2: æ‰‹åŠ¨æ‰§è¡ŒSQL
mysql -u root -p test < sql/add_dedup_task_fields.sql
```

### 2. æµ‹è¯•æ¥å£
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python scripts/test/test_create_dedup_task.py
```

### 3. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨Flaskåº”ç”¨
python app.py
```

### 4. æµ‹è¯•åˆ›å»ºä»»åŠ¡æ¥å£
```bash
# ä½¿ç”¨curlæµ‹è¯•
curl -X POST http://localhost:5000/api/dedup/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "task_name": "æµ‹è¯•ä»»åŠ¡",
    "analysis_type": "full",
    "config": {
      "similarity_threshold": 0.85
    }
  }'
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: å¦‚æœè¡¨ä¸­å·²æœ‰æ•°æ®ï¼Œæ–°å­—æ®µä¼šä½¿ç”¨é»˜è®¤å€¼ï¼ˆ`analysis_type='full'`, `estimated_duration=NULL`ï¼‰

2. **å­—æ®µéªŒè¯**: åˆ›å»ºä»»åŠ¡æ—¶ï¼Œå¦‚æœä¼ å…¥çš„ `analysis_type` ä¸æ˜¯æœ‰æ•ˆå€¼ï¼ˆfull/incremental/customï¼‰ï¼Œæ¥å£ä¼šè¿”å›400é”™è¯¯

3. **é¢„ä¼°æ—¶é•¿**: é¢„ä¼°æ—¶é•¿ä»…ä¾›å‚è€ƒï¼Œå®é™…æ‰§è¡Œæ—¶é—´å¯èƒ½å› æ•°æ®å¤æ‚åº¦ã€æœåŠ¡å™¨æ€§èƒ½ç­‰å› ç´ è€Œæœ‰æ‰€ä¸åŒ

4. **ä»»åŠ¡çŠ¶æ€**: ä»»åŠ¡åˆ›å»ºåä¸ä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œéœ€è¦è°ƒç”¨å¯åŠ¨æ¥å£æ‰èƒ½å¼€å§‹æ‰§è¡Œ

## ğŸ”— ç›¸å…³æ–‡ä»¶

- **æ¨¡å‹æ–‡ä»¶**: `src/models/question_dedup.py`
- **è·¯ç”±æ–‡ä»¶**: `src/routes/question_dedup.py`
- **è¿ç§»è„šæœ¬**: `scripts/database/migrate_add_dedup_task_fields.py`
- **SQLè„šæœ¬**: `sql/add_dedup_task_fields.sql`
- **æµ‹è¯•è„šæœ¬**: `scripts/test/test_create_dedup_task.py`
- **æ¥å£æ–‡æ¡£**: `docs/api/é¢˜ç›®å»é‡æ¥å£å‰ç«¯å¯¹æ¥.md`
- **è¿ç§»è¯´æ˜**: `docs/database/é¢˜ç›®å»é‡ä»»åŠ¡å­—æ®µæ›´æ–°è¯´æ˜.md`

## âœ… éªŒè¯æ¸…å•

- [x] æ•°æ®åº“å­—æ®µå·²æ·»åŠ 
- [x] æ¨¡å‹å·²æ›´æ–°
- [x] æ¥å£å·²æ›´æ–°
- [x] æ–‡æ¡£å·²æ›´æ–°
- [x] æµ‹è¯•å·²é€šè¿‡
- [x] è¿ç§»è„šæœ¬å·²æ‰§è¡ŒæˆåŠŸ

## ğŸ‰ å®ŒæˆçŠ¶æ€

æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡ï¼Œå¯ä»¥å¼€å§‹å‰ç«¯å¯¹æ¥ï¼

