## 前端权限对接说明

仅包含后端需要提供/返回的内容，前端自行完成路由渲染与按钮级鉴权。

### 1. 登录获取权限与菜单

- 接口：`POST /api/login`
- 入参：
  - `email` (string)
  - `password` (string)
  - 当登录失败次数超限时还需：
    - `captcha_session_key` (string)
    - `captcha_code` (string)
- 成功返回关键字段：
  - `access_token`：Bearer Token，后续请求放到 `Authorization: Bearer <token>`
  - `refresh_token`：用于刷新 access token
  - `expires_in`：access token 过期秒数
  - `permissions`：字符串数组，用户拥有的操作权限
  - `menus`：已按用户角色/权限过滤后的菜单树

示例返回（精简）：

```json
{
  "success": true,
  "data": {
    "user": { "id": 1, "email": "user@example.com", "role": "user" },
    "access_token": "xxx",
    "refresh_token": "yyy",
    "token_type": "Bearer",
    "expires_in": 3600,
    "permissions": ["test:view", "questionBank:view", "questionBank:detail"],
    "menus": [
      {
        "path": "/second",
        "name": "second",
        "component": "@/pages/second/index.vue",
        "meta": {
          "requiresAuth": true,
          "title": "主页面",
          "icon": "home",
          "hidden": false
        },
        "children": [
          {
            "path": "test",
            "name": "test",
            "component": "@/pages/test/index.vue",
            "meta": {
              "requiresAuth": true,
              "title": "测试页",
              "icon": "test",
              "hidden": false
            },
            "permissions": ["test:view"]
          }
        ]
      }
    ]
  }
}
```

### 2. 刷新 Token

- 接口：`POST /api/refresh-token`
- 入参：`refresh_token` (string)
- 返回：新的 `access_token`、`expires_in` 等

### 3. 登录验证码（仅登录失败超限时）

- 获取验证码：`GET /api/captcha`
  - 返回 `captcha_code`（展示给用户）与 `session_key`
- 登录时若后端返回 `code: REQUIRES_CAPTCHA`，前端需让用户输入验证码，并在 `/api/login` 携带 `captcha_session_key`（即 session_key）和 `captcha_code`。

### 4. 权限/菜单模型来源

- 定义文件：`src/services/permission_service.py`
  - `ALL_MENUS`：完整菜单树（包含组件路径、路由元信息、需权限的节点）
  - `ALL_PERMISSIONS`：所有操作权限列表
  - `ROLE_PERMISSIONS`：角色 -> 权限映射（`super_admin` 支持 `"*"`）
  - `ROLE_MENUS`：角色 -> 可访问菜单
- 登录接口在 `src/routes/auth.py`，会调用 `PermissionService.get_user_permission_info` 返回上述 `permissions` 与过滤后的 `menus`。

### 5. 前端对接建议（仅提示）

- 登录成功后：
  - 缓存 `access_token`；接口请求带 `Authorization: Bearer <token>`
  - 使用返回的 `menus` 构建路由
  - 使用 `permissions` 做按钮/功能级 `hasPermission` 判断
- Token 过期用 `refresh_token` 换新。
- 若收到 `REQUIRES_CAPTCHA`，先调用 `/api/captcha`，再携带验证码重试登录。
