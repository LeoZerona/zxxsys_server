# 测试数据库配置说明

## ✅ 已完成的修改

### 1. **pytest 测试配置** (`tests/conftest.py`)
- ✅ 已修改为使用 **MySQL test 数据库**
- ✅ 不再使用临时 SQLite 数据库
- ✅ 测试数据会保留在 MySQL test 数据库中

### 2. **注册功能测试脚本** (`test_register_api.py`)
- ✅ 已修改为使用 **MySQL test 数据库** 查询数据
- ✅ 创建独立的 Flask 应用实例连接 MySQL
- ✅ 显示当前使用的数据库信息

---

## 📊 数据库配置

所有测试用例现在使用：

**MySQL test 数据库**
- 主机: `localhost:3306`
- 用户: `root` (可通过环境变量 `MYSQL_USER` 修改)
- 密码: `123456` (可通过环境变量 `MYSQL_PASSWORD` 修改)
- 数据库: `test`

---

## 🔧 环境变量配置（可选）

如果需要使用不同的 MySQL 配置，可以设置环境变量：

```bash
# Windows PowerShell
$env:MYSQL_USER="root"
$env:MYSQL_PASSWORD="你的密码"
$env:MYSQL_HOST="localhost"
$env:MYSQL_PORT="3306"

# Windows CMD
set MYSQL_USER=root
set MYSQL_PASSWORD=你的密码
set MYSQL_HOST=localhost
set MYSQL_PORT=3306
```

或在 `.env` 文件中：

```env
MYSQL_USER=root
MYSQL_PASSWORD=你的密码
MYSQL_HOST=localhost
MYSQL_PORT=3306
```

---

## 📝 注意事项

1. **测试数据会保留**
   - pytest 测试和 `test_register_api.py` 运行后，数据会保留在 MySQL test 数据库中
   - 不会自动清理（与之前 SQLite 临时数据库不同）

2. **确保 MySQL 服务运行**
   - 测试前确保 MySQL 服务已启动
   - 确保 test 数据库和 users 表已创建

3. **主应用配置**
   - 主应用（`app.py`）也需要配置为使用 MySQL test 数据库
   - 确保 `.env` 文件或环境变量配置正确

---

## 🧪 运行测试

### pytest 测试
```bash
pytest tests/ -v
```

### 注册功能测试
```bash
python test_register_api.py
```

所有测试现在都会使用 **MySQL test 数据库**！

