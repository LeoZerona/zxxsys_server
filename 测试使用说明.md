# 测试使用说明

## ✅ 已完成的修改

所有测试脚本已经修改为**不发送真实邮件**，而是直接创建模拟验证码到数据库。

## 🎯 测试方式

### 方法一：快速测试（推荐）

```bash
python 快速测试用户注册.py
```

**特点**：
- ✅ 不发送真实邮件
- ✅ 直接创建模拟验证码
- ✅ 自动验证数据库中的数据
- ✅ 简单快速

### 方法二：完整测试

```bash
python scripts/test/test_register_api.py
```

**特点**：
- ✅ 不发送真实邮件
- ✅ 测试多种场景（MD5密码、明文密码、重复邮箱）
- ✅ 显示数据库中的所有用户
- ✅ 完整的测试报告

### 方法三：安全功能测试

```bash
python 测试注册安全功能.py
```

**特点**：
- ✅ 不发送真实邮件
- ✅ 测试安全防护功能
- ✅ 验证码邮箱匹配测试
- ✅ 验证码最新性测试

## 📋 测试前准备

1. **启动 Flask 应用**（终端 1）：
   ```bash
   python app.py
   ```

2. **运行测试**（终端 2）：
   ```bash
   python 快速测试用户注册.py
   ```

## 🔧 验证码模拟机制

### 工作原理

所有测试脚本都包含 `create_test_verification_code` 函数：

```python
def create_test_verification_code(email, code="123456", expire_minutes=10):
    """
    直接创建测试验证码到数据库（不发送邮件）
    """
    # 检查是否存在验证码
    # 如果存在，更新；如果不存在，创建新的
    # 保存到数据库
```

### 优势

1. **无需邮件服务**：测试时不需要配置邮箱服务
2. **测试更快**：无需等待邮件发送
3. **测试更可控**：可以精确控制验证码和过期时间
4. **节省资源**：不会发送真实邮件

### 默认验证码

- **验证码**：`123456`
- **过期时间**：10 分钟
- **可自定义**：可以指定任何验证码和过期时间

## 📝 示例

测试脚本会自动：

1. 生成测试邮箱（随机）
2. **创建模拟验证码到数据库**（不发送邮件）
3. 发送注册请求
4. 验证数据库中的数据

**输出示例**：
```
🔧 创建测试验证码到数据库（不发送邮件）...
✅ 测试验证码已创建: 123456
📤 发送注册请求...
✅ 注册成功！
✅ 数据库验证成功！
```

## ⚠️ 注意事项

1. **测试环境**：这些函数仅用于测试，生产环境应使用正常的邮件发送流程
2. **数据库**：验证码会直接写入数据库，无需经过邮件发送流程
3. **验证流程**：验证码仍然会经过正常的验证流程（匹配、过期检查等）

## 🎉 现在可以开始测试了

所有测试脚本都已更新，不会再发送真实邮件，直接运行测试即可！

