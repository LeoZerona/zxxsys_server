# 局域网访问配置说明

## 问题描述

前端尝试连接到 `192.168.0.102:5001` 时出现连接错误：
```
Error: connect ECONNREFUSED 192.168.0.102:5001
```

## 原因分析

当前服务器监听在 `127.0.0.1:5001`（仅本地访问），无法从局域网其他设备访问。

## 解决方案

### 方法1：重启服务器（推荐）

服务器代码已更新，默认监听 `0.0.0.0` 以支持局域网访问。请按以下步骤操作：

1. **停止当前服务器**
   - 在运行服务器的终端窗口按 `Ctrl+C` 停止服务器

2. **重新启动服务器**
   ```powershell
   # PowerShell
   .\start.ps1
   
   # 或直接运行
   python src/app.py
   ```

3. **确认服务器监听地址**
   启动后，服务器会显示：
   ```
   🌐 局域网访问地址:
      服务地址: http://192.168.0.102:5001
      API 路径: http://192.168.0.102:5001/api
      WebSocket: ws://192.168.0.102:5001/socket.io/
      ✅ 已启用局域网访问（监听 0.0.0.0）
   ```

### 方法2：使用环境变量配置

如果需要仅本地访问，可以设置环境变量：

```powershell
# Windows PowerShell
$env:HOST="127.0.0.1"
python src/app.py

# 如果需要局域网访问
$env:HOST="0.0.0.0"
python src/app.py
```

## 验证连接

重启服务器后，可以使用以下方式验证：

1. **检查端口监听状态**
   ```powershell
   netstat -ano | findstr ":5001"
   ```
   应该看到：
   ```
   TCP    0.0.0.0:5001         0.0.0.0:0              LISTENING       [PID]
   ```
   而不是：
   ```
   TCP    127.0.0.1:5001         0.0.0.0:0              LISTENING       [PID]
   ```

2. **测试API连接**
   ```powershell
   # 从本机测试
   curl http://localhost:5001/api/health
   
   # 从局域网其他设备测试（替换为实际IP）
   curl http://192.168.0.102:5001/api/health
   ```

## 防火墙配置

如果重启后仍然无法连接，可能需要配置防火墙：

1. **Windows 防火墙**
   - 打开"Windows Defender 防火墙"
   - 点击"高级设置"
   - 添加入站规则，允许端口 5001

2. **快速命令（管理员权限）**
   ```powershell
   netsh advfirewall firewall add rule name="Flask Server" dir=in action=allow protocol=TCP localport=5001
   ```

## 注意事项

1. **安全性**：监听 `0.0.0.0` 意味着服务器可以从任何网络接口访问，请确保：
   - 仅在开发环境使用
   - 生产环境应使用反向代理（如 Nginx）
   - 配置适当的防火墙规则

2. **端口占用**：如果端口被占用，服务器会自动尝试其他端口（5001, 5002, 8000, 8080）

3. **IP地址变化**：如果本机IP地址变化，前端需要更新连接地址

## 常见问题

**Q: 重启后仍然无法连接？**
A: 检查防火墙设置，确保端口 5001 未被阻止

**Q: 如何查看本机IP地址？**
A: 运行 `ipconfig`（Windows）或 `ifconfig`（Linux/Mac）

**Q: 前端应该使用哪个地址？**
A: 使用服务器启动时显示的局域网访问地址，例如：`http://192.168.0.102:5001`

