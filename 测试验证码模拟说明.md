# 测试验证码模拟说明

## ✅ 已完成的修改

所有测试脚本已经修改为**不发送真实邮件**，而是直接创建模拟验证码到数据库。

## 🔧 实现方式

### 创建测试验证码函数

所有测试脚本都添加了 `create_test_verification_code` 函数：

```python
def create_test_verification_code(email, code="123456", expire_minutes=10):
    """
    直接创建测试验证码到数据库（不发送邮件）
    """
    # 检查是否已存在验证码
    # 如果存在，更新；如果不存在，创建新的
    # 保存到数据库
```

### 使用方式

在测试中，不再调用 `/api/send-verification-code` 接口，而是直接调用：

```python
# 创建测试验证码（不发送邮件）
create_test_verification_code(test_email, "123456")
```

## 📝 修改的文件

1. ✅ `scripts/test/test_register_api.py`
   - 添加了 `create_test_verification_code` 函数
   - 所有测试函数都使用模拟验证码

2. ✅ `快速测试用户注册.py`
   - 添加了 `create_test_verification_code` 函数
   - 使用模拟验证码进行测试

3. ✅ `测试注册安全功能.py`
   - 添加了 `create_test_verification_code` 函数
   - 所有安全测试都使用模拟验证码

## 🎯 优势

1. **测试速度更快**：无需等待邮件发送
2. **测试更稳定**：不依赖邮件服务配置
3. **测试更可控**：可以精确控制验证码和过期时间
4. **节省资源**：不会发送真实的邮件

## 📋 测试验证码参数

- **默认验证码**：`123456`
- **默认过期时间**：10 分钟
- **可自定义**：可以指定任何验证码和过期时间

## 💡 使用示例

```python
# 创建默认验证码（123456，10分钟过期）
create_test_verification_code("test@example.com")

# 创建自定义验证码
create_test_verification_code("test@example.com", "888888")

# 创建自定义验证码和过期时间（5分钟）
create_test_verification_code("test@example.com", "888888", expire_minutes=5)
```

## ⚠️ 注意事项

1. 测试验证码直接写入数据库，不经过邮件发送流程
2. 验证码仍然会经过正常的验证流程（匹配、过期检查等）
3. 生产环境不应使用此函数，应使用正常的邮件发送流程

